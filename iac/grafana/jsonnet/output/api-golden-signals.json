{
   "description": "Golden Signals dashboard for API metrics: Latency, Traffic, Errors, and Saturation",
   "editable": true,
   "graphTooltip": 1,
   "panels": [
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "color": {
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": null
                     },
                     {
                        "color": "yellow",
                        "value": 10
                     },
                     {
                        "color": "red",
                        "value": 50
                     }
                  ]
               },
               "unit": "reqps"
            }
         },
         "gridPos": {
            "h": 4,
            "w": 6,
            "x": 0,
            "y": 0
         },
         "id": 1,
         "options": {
            "colorMode": "value",
            "graphMode": "area",
            "textMode": "value_and_name"
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum(rate(api_duration_milliseconds_count[5m]))",
               "legendFormat": "req/s"
            }
         ],
         "title": "Total Request Rate",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "color": {
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": null
                     },
                     {
                        "color": "yellow",
                        "value": 1
                     },
                     {
                        "color": "red",
                        "value": 5
                     }
                  ]
               },
               "unit": "percent"
            }
         },
         "gridPos": {
            "h": 4,
            "w": 6,
            "x": 6,
            "y": 0
         },
         "id": 2,
         "options": {
            "colorMode": "value",
            "graphMode": "area",
            "textMode": "value_and_name"
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum(rate(api_duration_milliseconds_count{http_status_code=~\"[45]..\"}[5m])) / sum(rate(api_duration_milliseconds_count[5m])) * 100",
               "legendFormat": "error %"
            }
         ],
         "title": "Error Rate (4xx + 5xx)",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "color": {
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": null
                     },
                     {
                        "color": "yellow",
                        "value": 500
                     },
                     {
                        "color": "red",
                        "value": 1000
                     }
                  ]
               },
               "unit": "ms"
            }
         },
         "gridPos": {
            "h": 4,
            "w": 6,
            "x": 12,
            "y": 0
         },
         "id": 3,
         "options": {
            "colorMode": "value",
            "graphMode": "area",
            "textMode": "value_and_name"
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "histogram_quantile(0.95, sum(rate(api_duration_milliseconds_bucket[5m])) by (le))",
               "legendFormat": "p95"
            }
         ],
         "title": "Avg Latency (p95)",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "color": {
                  "mode": "thresholds"
               },
               "thresholds": {
                  "steps": [
                     {
                        "color": "green",
                        "value": null
                     },
                     {
                        "color": "yellow",
                        "value": 10
                     },
                     {
                        "color": "red",
                        "value": 50
                     }
                  ]
               },
               "unit": "short"
            }
         },
         "gridPos": {
            "h": 4,
            "w": 6,
            "x": 18,
            "y": 0
         },
         "id": 4,
         "options": {
            "colorMode": "value",
            "graphMode": "area",
            "textMode": "value_and_name"
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum(api_active_requests)",
               "legendFormat": "active"
            }
         ],
         "title": "Active Requests",
         "type": "stat"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 10,
                  "showPoints": "never"
               },
               "unit": "ms"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 4
         },
         "id": 5,
         "options": {
            "legend": {
               "calcs": [
                  "mean",
                  "max"
               ],
               "displayMode": "table",
               "placement": "bottom"
            },
            "tooltip": {
               "mode": "multi"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "histogram_quantile(0.50, sum by (le, http_target, http_method) (rate(api_duration_milliseconds_bucket[5m])))",
               "legendFormat": "p50 - {{http_method}} {{http_target}}"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "histogram_quantile(0.95, sum by (le, http_target, http_method) (rate(api_duration_milliseconds_bucket[5m])))",
               "legendFormat": "p95 - {{http_method}} {{http_target}}"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "histogram_quantile(0.99, sum by (le, http_target, http_method) (rate(api_duration_milliseconds_bucket[5m])))",
               "legendFormat": "p99 - {{http_method}} {{http_target}}"
            }
         ],
         "title": "API Request Duration by Endpoint",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 10,
                  "showPoints": "never"
               },
               "unit": "ms"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 4
         },
         "id": 6,
         "options": {
            "legend": {
               "calcs": [
                  "mean",
                  "last"
               ],
               "displayMode": "table",
               "placement": "bottom"
            },
            "tooltip": {
               "mode": "multi"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum by (http_target, http_method) (rate(api_duration_milliseconds_sum[5m])) / sum by (http_target, http_method) (rate(api_duration_milliseconds_count[5m]))",
               "legendFormat": "{{http_method}} {{http_target}}"
            }
         ],
         "title": "Average Latency by Endpoint",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "barAlignment": 0,
                  "drawStyle": "bars",
                  "fillOpacity": 10,
                  "showPoints": "never"
               },
               "unit": "reqps"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 12
         },
         "id": 7,
         "options": {
            "legend": {
               "calcs": [
                  "mean",
                  "last"
               ],
               "displayMode": "table",
               "placement": "bottom"
            },
            "tooltip": {
               "mode": "multi"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum by (http_target, http_method) (rate(api_duration_milliseconds_count[5m]))",
               "legendFormat": "{{http_method}} {{http_target}}"
            }
         ],
         "title": "Request Rate by Endpoint",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 20,
                  "showPoints": "never"
               },
               "unit": "reqps"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 12
         },
         "id": 8,
         "options": {
            "legend": {
               "displayMode": "list",
               "placement": "bottom"
            },
            "tooltip": {
               "mode": "multi"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum by (http_method) (rate(api_duration_milliseconds_count[5m]))",
               "legendFormat": "{{http_method}}"
            }
         ],
         "title": "Request Rate by Method",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 10,
                  "showPoints": "never"
               },
               "unit": "reqps"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 20
         },
         "id": 9,
         "options": {
            "legend": {
               "calcs": [
                  "mean",
                  "max"
               ],
               "displayMode": "table",
               "placement": "bottom"
            },
            "tooltip": {
               "mode": "multi"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum by (http_status_code) (rate(api_duration_milliseconds_count{http_status_code=~\"4..\"}[5m]))",
               "legendFormat": "4xx - {{http_status_code}}"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum by (http_status_code) (rate(api_duration_milliseconds_count{http_status_code=~\"5..\"}[5m]))",
               "legendFormat": "5xx - {{http_status_code}}"
            }
         ],
         "title": "Error Rate by Status Code",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 20,
                  "showPoints": "never"
               },
               "max": 100,
               "min": 0,
               "unit": "percent"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 20
         },
         "id": 10,
         "options": {
            "tooltip": {
               "mode": "multi"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum(rate(api_duration_milliseconds_count{http_status_code=~\"4..\"}[5m])) / sum(rate(api_duration_milliseconds_count[5m])) * 100",
               "legendFormat": "4xx %"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum(rate(api_duration_milliseconds_count{http_status_code=~\"5..\"}[5m])) / sum(rate(api_duration_milliseconds_count[5m])) * 100",
               "legendFormat": "5xx %"
            }
         ],
         "title": "Error Percentage",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 10,
                  "showPoints": "never"
               },
               "unit": "reqps"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 28
         },
         "id": 11,
         "options": {
            "legend": {
               "calcs": [
                  "sum",
                  "mean"
               ],
               "displayMode": "table",
               "placement": "bottom"
            },
            "tooltip": {
               "mode": "multi"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum by (http_target, http_status_code) (rate(api_duration_milliseconds_count{http_status_code=~\"[45]..\"}[5m]))",
               "legendFormat": "{{http_status_code}} - {{http_target}}"
            }
         ],
         "title": "Errors by Endpoint",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 10,
                  "showPoints": "auto"
               },
               "unit": "short"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 36
         },
         "id": 12,
         "options": {
            "legend": {
               "calcs": [
                  "mean",
                  "max"
               ],
               "displayMode": "table",
               "placement": "bottom"
            },
            "tooltip": {
               "mode": "multi"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum by (http_method, http_target) (api_active_requests)",
               "legendFormat": "{{http_method}} {{http_target}}"
            }
         ],
         "title": "Active Requests by Endpoint",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 10,
                  "showPoints": "auto"
               },
               "unit": "short"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 36
         },
         "id": 13,
         "options": {
            "tooltip": {
               "mode": "multi"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum by (pod) (api_active_requests)",
               "legendFormat": "{{pod}}"
            }
         ],
         "title": "Active Requests by Pod",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 10,
                  "showPoints": "never"
               },
               "unit": "bytes"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 44
         },
         "id": 14,
         "options": {
            "legend": {
               "displayMode": "table",
               "placement": "bottom"
            },
            "tooltip": {
               "mode": "multi"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "histogram_quantile(0.95, sum by (le, http_target) (rate(api_request_size_bytes_bucket[5m])))",
               "legendFormat": "p95 - {{http_target}}"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum by (http_target) (rate(api_request_size_bytes_sum[5m])) / sum by (http_target) (rate(api_request_size_bytes_count[5m]))",
               "legendFormat": "avg - {{http_target}}"
            }
         ],
         "title": "Request Size (p95, avg)",
         "type": "timeseries"
      },
      {
         "datasource": {
            "type": "datasource",
            "uid": "-- Mixed --"
         },
         "fieldConfig": {
            "defaults": {
               "custom": {
                  "fillOpacity": 10,
                  "showPoints": "never"
               },
               "unit": "bytes"
            }
         },
         "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 44
         },
         "id": 15,
         "options": {
            "legend": {
               "displayMode": "table",
               "placement": "bottom"
            },
            "tooltip": {
               "mode": "multi"
            }
         },
         "pluginVersion": "v11.4.0",
         "targets": [
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "histogram_quantile(0.95, sum by (le, http_target) (rate(api_response_size_bytes_bucket[5m])))",
               "legendFormat": "p95 - {{http_target}}"
            },
            {
               "datasource": {
                  "type": "prometheus",
                  "uid": "$datasource"
               },
               "expr": "sum by (http_target) (rate(api_response_size_bytes_sum[5m])) / sum by (http_target) (rate(api_response_size_bytes_count[5m]))",
               "legendFormat": "avg - {{http_target}}"
            }
         ],
         "title": "Response Size (p95, avg)",
         "type": "timeseries"
      }
   ],
   "refresh": "30s",
   "schemaVersion": 39,
   "tags": [
      "api",
      "golden-signals",
      "sre",
      "monitoring"
   ],
   "templating": {
      "list": [
         {
            "name": "datasource",
            "query": "prometheus",
            "type": "datasource"
         }
      ]
   },
   "time": {
      "from": "now-1h",
      "to": "now"
   },
   "timezone": "browser",
   "title": "API Golden Signals",
   "uid": "api-golden-signals"
}
